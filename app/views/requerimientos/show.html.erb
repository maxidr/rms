<% if @requerimiento.errors.any? %>
	<div id="error_explanation">
    <h2>Ocurri처 el siguiente inconveniente:</h2>
    <ul>
    <% @requerimiento.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
<% end %>


<h1>Requerimiento N째 <%= @requerimiento.id %></h1>

<p>
  <b>Solicitante:</b>
  <%= @requerimiento.solicitante %>
</p>

<p>
  <b>Fecha de carga:</b>
  <%= l @requerimiento.created_at %>
</p>

<p>
  <b>Empresa:</b>
  <%= @requerimiento.empresa %>
</p>

<p>
  <b>Sector:</b>
  <%= @requerimiento.sector %>
</p>

<p>
  <b>Rubro:</b>
  <%= @requerimiento.rubro %>
</p>

<% if @requerimiento.estado.rechazo? %>
	<p class="estado_rechazado">
<% else %>
	<p>
<% end %>
		<b>Estado:</b>
		<%= @requerimiento.estado.to_s %>
		<% if @requerimiento.estado == Estado::PENDIENTE_RECEPCION %>
			<i>
			<%= " (Fecha probable de entrega: #{l @requerimiento.compra.fecha_probable_entrega})" %>
			</i>
		<% end %>
	</p>

<% if @requerimiento.estado.rechazo? %>
	<p class="estado_rechazado">
		<b>Motivo del rechazo:</b>
		<%= @requerimiento.motivo_rechazo %>
	</p>
<% end %>

<%= render "materiales" %>

<% if @requerimiento.estado >= Estado::APROBADO_X_COMPRAS %>
	<%= render "presupuestos/aprobado", :presupuesto => @requerimiento.presupuesto_aprobado %>
<% else %>
	<%= render "presupuestos/list", :presupuestos => @requerimiento.presupuestos %>
<% end %>


<br/>
<br/>

<% if can? :aprobar_presupuestos, @requerimiento %>
<p>
	<b>Aprobar presupuesto:</b>
	Para aprobar el requerimiento debe seleccionar un presupuesto y aprobarlo
</p>
<% end %>

<b>
	<% if can? :solicitar_aprobacion, @requerimiento %>
		<%= link_to 'Solicitar aprobaci처n', solicitar_aprobacion_requerimiento_path(@requerimiento), :method => :put %>
	<% end %>

	<% if can? :aprobar_por_sector, @requerimiento %>
		<%= link_to 'Aprobar requerimiento', aprobar_requerimiento_path(@requerimiento), :method => :put %>
		<br/>
		<%= link_to 'Rechazar requerimiento', rechazar_requerimiento_path(@requerimiento) %>
	<% end %>

	<% if can? :solicitar_aprobacion_compras, @requerimiento %>
		<%= link_to 'Solicitar aprobaci처n de compras', aprobacion_compras_requerimiento_path(@requerimiento), :method => :put  %>
	<% end %>

	<% if can? :aprobar_presupuestos, @requerimiento %>
		<%= link_to 'Rechazar presupuestos', rechazar_presupuestos_requerimiento_path(@requerimiento)  %>
	<% end %>

	<% if can? :recepcionar, @requerimiento %>
		<%= link_to 'Recepcionar materiales', recepcionar_requerimiento_path(@requerimiento), :method => :put %>
	<% end %>

	<% if can? :verificar_entrega, @requerimiento %>
		<%= link_to 'Entrega correcta', verificar_entrega_requerimiento_path(@requerimiento), :method => :put %>
		| 
		<%= link_to 'Rechazar entrega', rechazar_entrega_requerimiento_path(@requerimiento)  %>
	<% end %>

	<% if can? :finalizar, @requerimiento %>
		<%= link_to 'Finalizar requerimiento', finalizar_requerimiento_path(@requerimiento), :method => :put  %>
	<% end %>
</b>

<% if can? :comprar, @requerimiento %>
	<%= render "comprar" %>
<% end %>

<br/>

<% if can? :edit, @requerimiento %>
	<%= link_to 'Editar', edit_requerimiento_path(@requerimiento) %> |
<% end %>
<%= link_to 'Volver', requerimientos_path %>
<br/>

